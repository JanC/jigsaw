## jigsaw

Automatically generate a sequence diagram from JSON of Trace in Datadog.

⚠️ Only gRPC calls appear in the sequence diagram.

### Example

#### w/ response

```bash
$ jigsaw -config ./example/config.yaml ./example/trace.json
' Generated by https://github.com/upamune/jigsaw
@startuml
"v1-service" -> "v2-service": Ping Request
"v2-service" -> "v3-service": Pong Request
"v3-service" -> "v2-service": Pong Response
"v2-service" -> "v1-service": Ping Response
@enduml
```

![output](https://user-images.githubusercontent.com/8219560/127803698-763b9343-5429-417a-89b9-492e88ed08ff.png)

Or you can use [Mermaid.js](https://mermaid-js.github.io/mermaid/) instead of PlantUML.

```diff
--- a/example/config.yaml
+++ b/example/config.yaml
@@ -1,4 +1,4 @@
-type: plantuml
+type: mermaid
 include_services:
   - v1-service
   - v2-service
```

```bash
$ jigsaw -config ./example/config.yaml ./example/trace.json
%% Generated by https://github.com/upamune/jigsaw
sequenceDiagram
    v1-service->>v2-service: Ping Request
    v2-service->>v3-service: Pong Request
    v3-service->>v2-service: Pong Response
    v2-service->>v1-service: Ping Response
```

![mermaid-diagram](https://user-images.githubusercontent.com/8219560/135262942-c5b997a4-16ae-4d03-9f10-a8d0dd4d011c.png)

#### w/o response

```bash
$ jigsaw -config ./example/config.yaml -no-response ./example/trace.json
' Generated by https://github.com/upamune/jigsaw
@startuml
"v1-service" -> "v2-service": Ping Request
"v2-service" -> "v3-service": Pong Request
@enduml
```

![output](https://user-images.githubusercontent.com/8219560/127775036-b13113ff-496c-489c-8b1d-a6a756c62d97.png)

### Usage

You can get a trace as a JSON via `https://app.datadoghq.com/api/v1/trace/TRACE_ID`.

```bash
$ go get -u github.com/upamune/jigsaw
$ jigsaw trace.json -c config.yaml
```

```bash
$ cat config.yaml
type: plantuml
include_services:
  - foo-service
  - bar-service
exclude_grpc_services:
  - /foo.bar.v0.Service
grpc_serivce_alias:
  /foo.bar.v1.Service: v1-serivce
  /foo.bar.v2.Service: v2-serivce
```
